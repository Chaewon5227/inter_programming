{% extends "base.html" %}
{% block content %}
<section class="planner-header">
  <div>
    <h1>하루 플래너 &amp; 가계부</h1>
    <p class="subtitle">시간별 일정과 소비를 한눈에 관리하세요.</p>
  </div>
  <div class="selected-date-chip">
    <!-- 달력 선택 결과를 시각적으로 보여주는 칩 -->
    <span>{{ selected_date|date:"Y년 n월 j일" }}</span>
  </div>
</section>

{% if form_errors %}
<div class="form-errors">
  <!-- 사용자가 입력을 잘못한 경우 즉시 피드백을 보여준다. -->
  {% for error in form_errors %}
  <p>{{ error }}</p>
  {% endfor %}
</div>
{% endif %}

<section class="insight-cards">
  <article>
    <h3>지출 합계</h3>
    <strong>{{ daily_totals.expense|default:0 }}</strong>
  </article>
  <article>
    <h3>수입 합계</h3>
    <strong>{{ daily_totals.income|default:0 }}</strong>
  </article>
</section>

<div class="planner-layout">
  <aside class="calendar-panel">
    <header class="calendar-header">
      <a class="calendar-nav" href="?date={{ prev_month|date:'Y-m-d' }}" aria-label="이전 달">‹</a>
      <div class="calendar-title">{{ selected_date|date:"Y년 n월" }}</div>
      <a class="calendar-nav" href="?date={{ next_month|date:'Y-m-d' }}" aria-label="다음 달">›</a>
    </header>
    <table class="calendar-grid">
      <thead>
        <tr>
          {% for weekday in calendar_weekdays %}
          <th scope="col">{{ weekday }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for week in calendar_weeks %}
        <tr>
          {% for day in week %}
          <td class="day-cell{% if not day.in_month %} is-out{% endif %}{% if day.is_today %} is-today{% endif %}{% if day.is_selected %} is-selected{% endif %}">
            <a href="?date={{ day.date|date:'Y-m-d' }}" aria-current="{% if day.is_selected %}date{% else %}false{% endif %}">
              <span class="day-number">{{ day.date.day }}</span>
              {% if day.task_count %}
              <span class="task-dot" aria-label="일정 {{ day.task_count }}개">{{ day.task_count }}</span>
              {% endif %}
            </a>
          </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </aside>

  <section class="task-summary-panel">
    <header>
      <h2>할 일 목록</h2>
      <p>선택한 날짜의 일정들을 간단히 확인하세요.</p>
    </header>
    <ul class="task-list">
      {% if tasks %}
      {% for task in tasks %}
      <li>
        <div class="task-time">{{ task.start_at|date:"H:i"|default:"--:--" }} - {{ task.due_at|date:"H:i"|default:"--:--" }}</div>
        <div class="task-info">
          <strong>{{ task.title }}</strong>
          {% if task.description %}<p>{{ task.description }}</p>{% endif %}
        </div>
      </li>
      {% endfor %}
      {% else %}
      <li class="empty">선택한 날짜에 등록된 일정이 없습니다.</li>
      {% endif %}
    </ul>
    <button type="button" id="toggleDetails" class="more-button" data-expanded="false" aria-expanded="false">더보기</button>

    <div id="detailPanels" class="detail-panels" hidden>
      <div class="detail-grid">
        <section class="schedule-panel">
          <header>
            <h2>일정 타임테이블</h2>
          </header>
          {% if timed_tasks %}
          <div class="timetable" role="table">
            <div class="timetable-header" role="row">
              <span class="timetable-heading" role="columnheader">시간</span>
              <span class="timetable-heading" role="columnheader">지출</span>
              <span class="timetable-heading" role="columnheader">할 일</span>
            </div>
            <div class="timetable-body">
              {% for entry in timed_tasks %}
              <article class="timetable-row" role="row">
                <div class="timetable-time" role="cell">
                  <strong>{{ entry.start_local|date:"H:i"|default:"--:--" }}</strong>
                  {% if entry.end_local %}
                  <span class="timetable-time-range">~ {{ entry.end_local|date:"H:i" }}</span>
                  {% endif %}
                </div>
                <div class="timetable-expense" role="cell">
                  {% if entry.transactions %}
                  {% for tx in entry.transactions %}
                  <div class="expense-chip">
                    <span class="expense-name">{{ tx.category.name }}</span>
                    <strong class="expense-amount">{{ tx.amount }}</strong>
                  </div>
                  {% endfor %}
                  {% else %}
                  <span class="empty">지출 없음</span>
                  {% endif %}
                </div>
                <div class="timetable-task" role="cell">
                  <div class="task-card">
                    <h3>{{ entry.task.title }}</h3>
                    {% if entry.task.description %}<p class="desc">{{ entry.task.description }}</p>{% endif %}
                  </div>
                </div>
              </article>
              {% endfor %}
            </div>
          </div>
          {% else %}
          <p class="empty">선택한 날짜에 시간이 설정된 일정이 없습니다.</p>
          {% endif %}

          {% if untimed_tasks %}
          <!-- 시간 정보가 없는 할 일을 별도로 묶어준다. -->
          <div class="untimed-section">
            <h3>시간 외 할 일</h3>
            <ul class="untimed-list">
              {% for entry in untimed_tasks %}
              <li>
                <div>
                  <strong>{{ entry.task.title }}</strong>
                  {% if entry.task.description %}<p>{{ entry.task.description }}</p>{% endif %}
                </div>
                <div class="untimed-expense">
                  {% if entry.transactions %}
                  {% for tx in entry.transactions %}
                  <span>{{ tx.category.name }} {{ tx.amount }}</span>
                  {% endfor %}
                  {% else %}
                  <span class="empty">지출 없음</span>
                  {% endif %}
                </div>
              </li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}
        </section>

        <section class="ledger-panel">
          <header>
            <h2>가계부 기록</h2>
            <div class="ledger-actions">
              <!-- 팝업을 띄우기 위한 트리거 버튼 -->
              <button type="button" data-open="scheduleDialog">일정 + 지출 추가</button>
              <button type="button" data-open="transactionDialog">지출만 추가</button>
            </div>
          </header>
          <div class="transaction-list">
            {% if loose_transactions %}
            <h3 class="loose-title">일정 외 지출</h3>
            {% for tx in loose_transactions %}
            <article>
              <header>
                <span class="time">{{ tx.occurred_at|date:"H:i" }}</span>
                <span class="amount">{{ tx.amount }}</span>
              </header>
              <p>{{ tx.category.name }} · {{ tx.account.name }}</p>
              {% if tx.memo %}<p class="memo">{{ tx.memo }}</p>{% endif %}
            </article>
            {% endfor %}
            {% else %}
            <p class="empty">일정과 분리된 지출이 없습니다.</p>
            {% endif %}
          </div>
        </section>
      </div>

      <dialog id="scheduleDialog" class="planner-dialog">
        <form method="post" class="form-card">
          {% csrf_token %}
          <input type="hidden" name="form_type" value="schedule_entry"/>
          <header>
            <h3>일정과 함께 기록하기</h3>
            <button type="button" class="close" data-close>×</button>
          </header>
          <label>제목<input name="title" placeholder="예: 점심 약속" required/></label>
          <label>설명<textarea name="description" rows="2" placeholder="세부 사항을 메모하세요."></textarea></label>
          <div class="time-grid">
            <label>시작<input type="time" name="start_time" required/></label>
            <label>종료<input type="time" name="end_time"/></label>
          </div>
          <div class="amount-grid">
            <label>계좌
              <select name="account">
                <option value="">선택 안 함</option>
                {% for account in accounts %}
                <option value="{{ account.id }}">{{ account.name }}</option>
                {% endfor %}
              </select>
            </label>
            <label>분류
              <select name="category">
                <option value="">선택 안 함</option>
                {% for category in categories %}
                <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
              </select>
            </label>
            <label>금액<input type="number" step="0.01" name="amount" placeholder="0"/></label>
          </div>
          <label>메모<input name="memo" placeholder="필요하면 메모를 남겨주세요."/></label>
          <footer>
            <button type="submit">일정 + 지출 저장</button>
          </footer>
        </form>
      </dialog>

      <dialog id="transactionDialog" class="planner-dialog">
        <form method="post" class="form-card">
          {% csrf_token %}
          <input type="hidden" name="form_type" value="loose_transaction"/>
          <header>
            <h3>단독 지출 추가</h3>
            <button type="button" class="close" data-close>×</button>
          </header>
          <div class="time-grid">
            <label>시간<input type="time" name="occurred_time" required/></label>
            <label>금액<input type="number" step="0.01" name="amount" required/></label>
          </div>
          <label>계좌
            <select name="account" required>
              {% for account in accounts %}
              <option value="{{ account.id }}">{{ account.name }}</option>
              {% endfor %}
            </select>
          </label>
          <label>분류
            <select name="category" required>
              {% for category in categories %}
              <option value="{{ category.id }}">{{ category.name }}</option>
              {% endfor %}
            </select>
          </label>
          <label>메모<input name="memo" placeholder="어떤 소비였나요?"/></label>
          <footer>
            <button type="submit">지출만 저장</button>
          </footer>
        </form>
      </dialog>

      <noscript>
        <div class="ledger-forms">
          <!-- 자바스크립트가 없는 환경을 위한 폴백 폼 -->
          <h3>일정과 함께 기록하기</h3>
          <form method="post" class="form-card">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="schedule_entry"/>
            <label>제목<input name="title" placeholder="예: 점심 약속" required/></label>
            <label>설명<textarea name="description" rows="2" placeholder="세부 사항을 메모하세요."></textarea></label>
            <div class="time-grid">
              <label>시작<input type="time" name="start_time" required/></label>
              <label>종료<input type="time" name="end_time"/></label>
            </div>
            <div class="amount-grid">
              <label>계좌
                <select name="account">
                  <option value="">선택 안 함</option>
                  {% for account in accounts %}
                  <option value="{{ account.id }}">{{ account.name }}</option>
                  {% endfor %}
                </select>
              </label>
              <label>분류
                <select name="category">
                  <option value="">선택 안 함</option>
                  {% for category in categories %}
                  <option value="{{ category.id }}">{{ category.name }}</option>
                  {% endfor %}
                </select>
              </label>
              <label>금액<input type="number" step="0.01" name="amount" placeholder="0"/></label>
            </div>
            <label>메모<input name="memo" placeholder="필요하면 메모를 남겨주세요."/></label>
            <button type="submit">일정 + 지출 저장</button>
          </form>

          <h3>단독 지출 추가</h3>
          <form method="post" class="form-card">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="loose_transaction"/>
            <div class="time-grid">
              <label>시간<input type="time" name="occurred_time" required/></label>
              <label>금액<input type="number" step="0.01" name="amount" required/></label>
            </div>
            <label>계좌
              <select name="account" required>
                {% for account in accounts %}
                <option value="{{ account.id }}">{{ account.name }}</option>
                {% endfor %}
              </select>
            </label>
            <label>분류
              <select name="category" required>
                {% for category in categories %}
                <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
              </select>
            </label>
            <label>메모<input name="memo" placeholder="어떤 소비였나요?"/></label>
            <button type="submit">지출만 저장</button>
          </form>
        </div>
      </noscript>
    </div>
  </section>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // 팝업을 열기 위한 버튼과 다이얼로그를 연결한다.
    document.querySelectorAll('[data-open]').forEach((button) => {
      button.addEventListener('click', () => {
        const dialogId = button.getAttribute('data-open');
        const dialog = document.getElementById(dialogId);
        if (dialog && typeof dialog.showModal === 'function') {
          dialog.showModal();
        }
      });
    });

    // 닫기 버튼을 누르면 해당 다이얼로그만 닫는다.
    document.querySelectorAll('dialog [data-close]').forEach((button) => {
      button.addEventListener('click', () => {
        const dialog = button.closest('dialog');
        if (dialog) {
          dialog.close();
        }
      });
    });

    // 더보기 버튼으로 상세 패널을 토글한다.
    const toggleButton = document.getElementById('toggleDetails');
    const detailPanels = document.getElementById('detailPanels');
    if (toggleButton && detailPanels) {
      toggleButton.addEventListener('click', () => {
        const expanded = toggleButton.getAttribute('data-expanded') === 'true';
        const nextState = !expanded;
        toggleButton.setAttribute('data-expanded', nextState ? 'true' : 'false');
        toggleButton.setAttribute('aria-expanded', nextState ? 'true' : 'false');
        toggleButton.textContent = nextState ? '접기' : '더보기';
        if (nextState) {
          detailPanels.removeAttribute('hidden');
        } else {
          detailPanels.setAttribute('hidden', '');
        }
      });
    }
  });
</script>

<style>
  /* 대시보드 전용 레이아웃과 밝은 테마 색상 조합을 정의한다. */
  .planner-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }
  .planner-header h1 {
    font-size: 2rem;
    margin: 0;
  }
  .planner-header .subtitle {
    color: #4f5d75;
    margin: 0.35rem 0 0;
  }
  .selected-date-chip {
    background: #111111;
    color: #ffffff;
    border-radius: 999px;
    padding: 0.5rem 1.25rem;
    font-weight: 600;
  }
  .form-errors {
    /* 에러 피드백 역시 밝은 배경에 어울리도록 수정한다. */
    background: #fff5f5;
    border: 1px solid #ffc9c9;
    color: #c92a2a;
    padding: 0.75rem 1rem;
    border-radius: 16px;
    margin-bottom: 1.5rem;
  }
  .form-errors p {
    margin: 0.25rem 0;
  }
  .insight-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }
  .insight-cards article {
    background: #ffffff;
    border-radius: 20px;
    padding: 1.25rem;
    border: 1px solid #e5e7eb;
  }
  .insight-cards h3 {
    margin: 0 0 0.5rem 0;
    color: #334155;
  }
  .insight-cards strong {
    font-size: 1.5rem;
  }
  .planner-layout {
    display: grid;
    grid-template-columns: minmax(0, 0.9fr) minmax(0, 1.1fr);
    gap: 2rem;
    align-items: start;
  }
  .calendar-panel {
    background: #ffffff;
    border-radius: 20px;
    border: 1px solid #e5e7eb;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
  }
  .calendar-title {
    font-weight: 600;
    font-size: 1.1rem;
  }
  .calendar-nav {
    display: grid;
    place-items: center;
    width: 2.75rem;
    height: 2.75rem;
    border-radius: 999px;
    background: #f1f3f5;
    color: #111111;
    text-decoration: none;
    font-size: 1.5rem;
    border: 1px solid #e5e7eb;
  }
  .calendar-nav:hover {
    background: #e6ebf0;
  }
  .calendar-grid {
    width: 100%;
    border-collapse: collapse;
  }
  .calendar-grid th,
  .calendar-grid td {
    text-align: center;
    padding: 0.5rem 0.25rem;
  }
  .day-cell a {
    display: grid;
    justify-items: center;
    gap: 0.35rem;
    text-decoration: none;
    color: inherit;
    padding: 0.5rem 0.25rem;
    border-radius: 12px;
  }
  .day-cell.is-out a {
    color: #adb5bd;
  }
  .day-cell.is-today a {
    border: 1px solid #4f5d75;
  }
  .day-cell.is-selected a {
    background: #111111;
    color: #ffffff;
  }
  .day-number {
    font-weight: 600;
  }
  .task-dot {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 1.75rem;
    height: 1.5rem;
    padding: 0 0.5rem;
    border-radius: 999px;
    background: #f1f3f5;
    color: #111111;
    font-size: 0.75rem;
    font-weight: 600;
  }
  .day-cell.is-selected .task-dot {
    background: #ffffff;
    color: #111111;
  }
  .day-cell.is-out .task-dot {
    background: #edf2f7;
    color: #94a3b8;
  }
  .task-summary-panel {
    background: #ffffff;
    border-radius: 20px;
    border: 1px solid #e5e7eb;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }
  .task-summary-panel header h2 {
    margin: 0;
  }
  .task-summary-panel header p {
    margin: 0.35rem 0 0;
    color: #6b7280;
  }
  .task-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  .task-list li {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
    background: #f8f9fb;
    border-radius: 16px;
    border: 1px solid #e5e7eb;
    padding: 0.75rem 1rem;
  }
  .task-list li.empty {
    justify-content: center;
    text-align: center;
    color: #6b7280;
  }
  .task-time {
    font-weight: 600;
    min-width: 4.5rem;
  }
  .task-info p {
    margin: 0.25rem 0 0;
    color: #6b7280;
  }
  .more-button {
    background: #111111;
    color: #ffffff;
    border-radius: 999px;
    border: none;
    font-weight: 600;
    padding: 0.5rem 1.5rem;
    cursor: pointer;
  }
  .detail-panels {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }
  .detail-grid {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
    gap: 1.75rem;
  }
  .schedule-panel,
  .ledger-panel {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }
  .ledger-panel header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .ledger-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }
  .ledger-actions button {
    background: #111111;
    color: #ffffff;
    border: 1px solid #111111;
    border-radius: 999px;
    padding: 0.45rem 1.1rem;
    cursor: pointer;
    font-weight: 600;
  }
  .ledger-actions button:hover {
    background: #2d2d2d;
  }
  .schedule-panel header h2,
  .ledger-panel header h2 {
    margin: 0;
  }
  .timetable {
    display: flex;
    flex-direction: column;
    border: 1px solid #e5e7eb;
    border-radius: 20px;
    overflow: hidden;
    background: #ffffff;
  }
  .timetable-header,
  .timetable-row {
    display: grid;
    grid-template-columns: 120px 1fr 1.2fr;
    align-items: stretch;
  }
  .timetable-header {
    background: #ffd6f5;
    color: #111111;
    font-weight: 700;
    padding: 0.75rem 1.25rem;
    gap: 1rem;
  }
  .timetable-heading {
    display: flex;
    align-items: center;
    justify-content: flex-start;
  }
  .timetable-body {
    display: flex;
    flex-direction: column;
  }
  .timetable-row {
    gap: 1rem;
    border-top: 1px solid #f1f3f5;
    padding: 1rem 1.25rem;
    background: #ffffff;
  }
  .timetable-time {
    display: flex;
    flex-direction: column;
    font-weight: 600;
    color: #334155;
    letter-spacing: 0.05em;
    gap: 0.35rem;
  }
  .timetable-time-range {
    font-size: 0.9rem;
    color: #6b7280;
  }
  .timetable-expense {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }
  .timetable-task {
    display: flex;
    align-items: stretch;
  }
  .expense-chip {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #fdf2ff;
    border: 1px solid #f5d0fe;
    border-radius: 12px;
    padding: 0.5rem 0.75rem;
    font-size: 0.95rem;
  }
  .expense-name {
    color: #4b5563;
  }
  .expense-amount {
    color: #c026d3;
  }
  .timetable-task .task-card {
    height: 100%;
  }
  .task-card {
    background: #ffffff;
    border: 1px solid #e5e7eb;
    border-radius: 20px;
    padding: 1.25rem;
  }
  .task-card h3 {
    margin: 0 0 0.5rem 0;
  }
  .task-card .desc {
    margin: 0 0 1rem 0;
    color: #4b5563;
  }
  .untimed-section {
    margin-top: 1.5rem;
    background: #fff7fb;
    border: 1px solid #fbcfe8;
    border-radius: 18px;
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .untimed-section h3 {
    margin: 0;
  }
  .untimed-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  .untimed-list li {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
    background: #ffffff;
    border-radius: 12px;
    padding: 0.75rem 1rem;
    border: 1px solid #f8bbd0;
  }
  .untimed-list li p {
    margin: 0.35rem 0 0;
    color: #6b7280;
  }
  .untimed-expense {
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
    font-weight: 600;
    color: #c026d3;
    min-width: 140px;
    text-align: right;
  }
  .transaction-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  .transaction-list .loose-title {
    margin: 0;
    font-size: 1rem;
    color: #334155;
  }
  .transaction-list article {
    background: #ffffff;
    border-radius: 18px;
    padding: 1rem 1.25rem;
    border: 1px solid #e5e7eb;
  }
  .transaction-list header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 0.3rem;
  }
  .transaction-list .time {
    font-weight: 600;
    letter-spacing: 0.05em;
  }
  .transaction-list .amount {
    font-weight: 700;
  }
  .transaction-list .linked {
    color: #4b5563;
    margin: 0.25rem 0;
  }
  .transaction-list .memo {
    color: #6b7280;
    margin: 0;
  }
  .empty {
    color: #94a3b8;
  }
  .planner-dialog {
    border: none;
    border-radius: 22px;
    padding: 0;
    max-width: 500px;
    width: 100%;
    background: #ffffff;
    color: #111111;
  }
  .planner-dialog::backdrop {
    background: rgba(15, 23, 42, 0.35);
  }
  .planner-dialog form {
    padding: 1.75rem;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .planner-dialog form header,
  .planner-dialog form footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .planner-dialog form header h3 {
    margin: 0;
  }
  .planner-dialog form .close {
    background: transparent;
    border: none;
    color: #111111;
    font-size: 1.5rem;
    line-height: 1;
    cursor: pointer;
  }
  .planner-dialog footer button {
    width: 100%;
  }
  .ledger-forms {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }
  .form-card {
    background: #ffffff;
    border-radius: 20px;
    border: 1px solid #e5e7eb;
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    gap: 0.85rem;
  }
  .form-card label {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    font-weight: 600;
    color: #111111;
  }
  .time-grid,
  .amount-grid {
    display: grid;
    gap: 0.75rem;
  }
  .time-grid {
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  }
  .amount-grid {
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  }
  @media (max-width: 1080px) {
    .planner-layout {
      grid-template-columns: 1fr;
    }
    .detail-grid {
      grid-template-columns: 1fr;
    }
    .timetable {
      border-radius: 18px;
    }
    .timetable-header,
    .timetable-row {
      grid-template-columns: minmax(0, 1fr);
    }
    .timetable-header {
      display: none;
    }
    .timetable-row {
      border-top: 1px solid #f1f3f5;
      padding: 1rem;
    }
    .timetable-time,
    .timetable-expense,
    .timetable-task {
      gap: 0.25rem;
    }
    .timetable-expense {
      order: 3;
    }
    .timetable-task {
      order: 2;
    }
  }
  @media (max-width: 640px) {
    .planner-header {
      flex-direction: column;
      align-items: flex-start;
    }
    .selected-date-chip {
      align-self: stretch;
      text-align: center;
    }
    .calendar-header {
      flex-direction: row;
    }
    .task-list li {
      flex-direction: column;
    }
    .task-time {
      min-width: 0;
    }
  }
</style>
{% endblock %}
